<!DOCTYPE html>
<html>

<head>
    <title>Socket.IO chat</title>
</head>

<body>
    <div>
        <p id="idUser"></p>
    </div>
    <ul id="messages"></ul>
    <form id="form" action="">
        <p>Destinataire : </p>
        <input id="destinataire" autocomplete="off" />
        <p>Message : </p>
        <input id="input" autocomplete="off" /><button>Send</button>
    </form>
    <script src="/socket.io/socket.io.js"></script>
    <script src="./js/index.js"></script>
    <script>
        function getRandomInt(min, max) {
            min = Math.ceil(min);
            max = Math.floor(max);
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }
        // Usage example
        var randomNumber = getRandomInt(1, 10);



        var socket = io({ query: { id: randomNumber } });
        var form = document.getElementById('form');
        var input = document.getElementById('input');
        var dest = document.getElementById('destinataire');
        var userParagraph = document.getElementById('idUser');
        userParagraph.innerHTML = `User : ${randomNumber}`
        form.addEventListener('submit', function (e) {
            e.preventDefault();
            
            if (input.value) {
                const body = {"msg": input.value};
                if (dest.value) {
                    body["dest"] = dest.value;
                }
                socket.emit('chat message', JSON.stringify(body));
                input.value = '';

            }
        });
        socket.on('chat message', function (msg) {
            var item = document.createElement('li');
            item.textContent = msg;
            messages.appendChild(item);
            window.scrollTo(0, document.body.scrollHeight);
        });
    </script>
</body>

</html>